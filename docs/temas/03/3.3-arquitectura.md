# **3.3 Arquitectura**

En Android, la arquitectura de una aplicación se refiere a la estructura y organización de sus componentes, como las actividades, fragmentos, servicios y otros elementos que la componen.

Una buena arquitectura es fundamental para crear aplicaciones robustas, escalables y fáciles de mantener.

Antes de continuar y realizar las actividades de este apartado, [**lee a la documentación de concepto de arquitectura**](../00-android/02-arquitectura.md)

---

## 3.3.1 **Principios de Arquitectura** 
 
El diseño de la arquitectura de una aplicación define los límites y las responsabilidades de sus partes. Para construir una aplicación robusta que pueda crecer y adaptarse a diversos factores de forma, se deben seguir los siguientes principios:

1. **Separación de Problemas (El Principio Fundamental):** 

    Este es el principio más importante. Consiste en evitar escribir todo el código en clases basadas en la IU, como `Activity` o `Fragment`. Estas clases solo deben contener la lógica relacionada con las interacciones de la IU y del sistema operativo. Al mantenerlas limpias, se mitigan los problemas relacionados con su ciclo de vida volátil, ya que el SO puede destruirlas en cualquier momento.

2. **Controlar la IU a partir de modelos de datos:** 

    La interfaz de usuario debe ser impulsada por modelos de datos, que idealmente deben ser **persistentes**. Estos modelos son independientes de la IU y del ciclo de vida de los componentes, lo que mejora la solidez y la capacidad de prueba de la aplicación.

3. **Diseños Adaptables:** 
 
    La aplicación debe manejar correctamente los **cambios de configuración** (como la orientación vertical/horizontal y los diferentes tamaños de pantalla) para proporcionar una experiencia de usuario óptima en múltiples factores de forma.

### **Arquitectura moderna de Apps** 

La arquitectura moderna de apps promueve técnicas específicas que se implementan en las capas anteriores para asegurar la robustez del sistema:

1. **Arquitectura adaptable y en capas**.
2. **Flujo unidireccional de datos (UDF)** en todas las capas.
3. Uso de **contenedores de estado** en la capa de la IU para administrar la complejidad.
4. Uso de **Corrutinas y Flows** (Flujos) para operaciones asíncronas.
5. Uso de las **mejores prácticas para la inserción de dependencias (DI)**. Google recomienda seguir estos patrones y usar la biblioteca **Hilt** para construir automáticamente objetos y proporcionar verificación de dependencias en tiempo de compilación.


### **Arquitectura recomendada en Android**

La arquitectura de aplicaciones recomendada por Android está diseñada para gestionar las condiciones de lanzamiento variables y las restricciones de recursos de los dispositivos móviles. Considerando los principios comunes, **toda aplicación debe tener al menos dos capas**: la Capa de la IU y la Capa de Datos. Una tercera capa, la Capa de Dominio, es opcional.

<figcaption>
  <img src="https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview.png?hl=es-419" alt="Esquema de roles de color de Material 3">
  <p style="text-align: center; font-style: italic;">estructura jerárquica de la aplicación</p>
</figcaption>

!!! info "Diagrama de arquitectura de una app"
   
    **arquitectura de app típica** muestra la estructura jerárquica de la aplicación, donde las flechas representan las dependencias entre las clases. Por ejemplo, la Capa de Dominio depende de las clases de la Capa de Datos.

#### **1. Capa de la IU (Capa de Presentación)**

`Función:` Mostrar los datos de la aplicación en la pantalla y actualizar la IU cuando los datos cambian, ya sea por interacción del usuario o entrada externa (como una respuesta de red). Sus elementos clave son:

- **Elementos de la IU:** Componentes que renderizan los datos. Se pueden compilar con **Vistas** o con las **funciones de Jetpack Compose**. Ambas opciones admiten diseños adaptables.

- **Contenedores de estados (State holders):** Clases (como **ViewModel**) que retienen los datos, los exponen a la IU y controlan la lógica de la IU.

<figcaption>
  <img src="https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview-ui.png?hl=es-419" alt="El rol de la capa de la IU en la arquitectura de la app.">
  <p style="text-align: center; font-style: italic;">El rol de la capa de la IU en la arquitectura de la app.</p>
</figcaption>

<br/>

#### **2. Capa de Datos**

`Función:` Contener la **lógica empresarial** de la aplicación, es decir, las reglas que determinan cómo se crean, almacenan y modifican los datos de la aplicación.

**Estructura:** Está compuesta por Repositorios, que administran las Fuentes de Datos.

!!! info "Repositorios"
    Las clases de repositorio son responsables de las siguientes tareas:

    - Exponer datos al resto de la app
    - Centralizar los cambios en los datos
    - Resolver conflictos entre múltiples fuentes de datos
    - Abstraer fuentes de datos del resto de la app
    - Contener la lógica empresarial

- **Repositorios:** Debe haber una clase de repositorio para cada tipo de dato que se administre (por ejemplo, `MoviesRepository` o `PaymentsRepository`).

- **Responsabilidades:** Exponer datos al resto de la app, centralizar los cambios en los datos, resolver conflictos entre múltiples fuentes, **abstraer las fuentes de datos** y contener la lógica empresarial.

- **Fuentes de Datos:** Cada fuente de datos es responsable de trabajar con una **sola fuente de datos** (una red, un archivo o una base de datos local).

<figcaption>
  <img src="https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview-data.png?hl=es-419" alt="El rol de la capa de datos en la arquitectura de la app.">
  <p style="text-align: center; font-style: italic;">El rol de la capa de la IU en la arquitectura de la app.</p>
</figcaption>

> La imagen ilusta el rol de la capa de datos en la arquitectura de la app10. Esta capa es vital para la solidez, pues fomenta una arquitectura que prioriza la condición sin conexión (offline first), donde la fuente de información de la aplicación suele ser una base de datos.

<br/>

#### **3. Capa de Dominio (Opcional)**

- **Función:** Encapsular la **lógica empresarial compleja** o la lógica simple que se **reutiliza** en varios `ViewModels`.
- **Naturaleza:** Es una capa opcional que se utiliza únicamente cuando se necesita administrar la complejidad o favorecer la reutilización, ubicándose entre la capa de IU y la de datos.
- **Estructura:** Las clases de esta capa se conocen como **casos de uso** (_use cases_) o **interactores**13. Cada caso de uso debe enfocarse en una **funcionalidad única** (ejemplo: una clase `GetTimeZoneUseCase` si varios ViewModels necesitan consultar la zona horaria).

<figcaption>
  <img src="https://developer.android.com/static/topic/libraries/architecture/images/mad-arch-overview-domain.png?hl=es-4199" alt="El rol de la capa de datos en la arquitectura de la app.">
  <p style="text-align: center; font-style: italic;">El rol de la capa de la dominio en la arquitectura de la app.</p>
</figcaption>

> La imagen muestra **el rol de la capa de dominio en la arquitectura de la app**, sirviendo como un mediador para la lógica compleja antes de que los datos lleguen a la capa de presentación.


---



